---
import Logo from '../assets/Logo_Patrick_Lim_Black.svg';
---

<nav class="flex sticky top-0 z-50 w-full px-4 sm:px-6 lg:px-8 py-3 sm:py-4 border-b border-gray-200 bg-white/60 backdrop-blur-md">
    <div class="flex w-full items-center justify-between max-w-[1440px] mx-auto">
        <a href="/" class="flex items-center gap-2 transition hover:opacity-80">
            <Logo/>
            <span class="text-lg sm:text-xl font-bold tracking-tight text-gray-900">Patrick Lim</span>
        </a>
        
        <!-- Desktop Navigation -->
        <div class="hidden lg:flex items-center gap-8">
            <a href="#work" class="text-sm font-medium text-gray-900 transition hover:text-indigo-600 smooth-scroll-link">Work</a>
            <a href="#skills" class="text-sm font-medium text-gray-900 transition hover:text-indigo-600 smooth-scroll-link">Skills</a>
            <a href="#process" class="text-sm font-medium text-gray-900 transition hover:text-indigo-600 smooth-scroll-link">Process</a>
            <a href="https://drive.google.com/file/d/1y_O1U4hITaNJYH1SGIr4V9HLGa61QxEq/view?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-gray-900 transition hover:text-indigo-600">Download CV</a>
            
            <div class="flex items-center gap-4">
                <a href="https://www.linkedin.com/in/patrickjameslim/" target="_blank" class="flex items-center gap-2 rounded-lg border bg-white border-gray-200 px-3 py-2 text-sm font-medium transition hover:bg-indigo-600 hover:text-white">
                    <i class="ri-linkedin-fill"></i>
                </a>
                <div class="relative">
                  <button
                    id="copy-email-btn"
                    type="button"
                    class="flex items-center gap-2 rounded-lg border bg-white border-gray-200 px-4 py-2 text-sm font-medium transition hover:bg-indigo-600 hover:text-white"
                  >
                    <span class="text-gray-400">
                      <i class="ri-mail-line"></i>
                    </span>
                    <span class="hidden xl:inline">patricklim0907@gmail.com</span>
                    <span class="xl:hidden">Email</span>
                  </button>
                  <div
                    id="copy-email-toast"
                    class="absolute left-1/2 top-full mt-2 -translate-x-1/2 translate-y-2 rounded-md bg-slate-900 text-white text-xs px-3 py-1 shadow-sm opacity-0 pointer-events-none transition duration-200 whitespace-nowrap"
                  >
                    Copied to clipboard!
                  </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu Button -->
        <button
            id="mobile-menu-btn"
            type="button"
            class="lg:hidden flex items-center justify-center w-10 h-10 rounded-lg border border-gray-200 bg-white text-gray-900 transition hover:bg-gray-50"
            aria-label="Toggle menu"
        >
            <i id="menu-icon" class="ri-menu-line text-xl"></i>
            <i id="close-icon" class="ri-close-line text-xl hidden"></i>
        </button>
    </div>
    
    <!-- Mobile Menu -->
    <div
        id="mobile-menu"
        class="lg:hidden absolute top-full left-0 right-0 bg-white border-b border-gray-200 shadow-lg opacity-0 pointer-events-none transition-all duration-200 max-h-0 overflow-hidden"
    >
        <div class="max-w-[1440px] mx-auto px-4 sm:px-6 py-4 space-y-4">
            <a href="#work" class="block text-base font-medium text-gray-900 transition hover:text-indigo-600 py-2 smooth-scroll-link">Work</a>
            <a href="#skills" class="block text-base font-medium text-gray-900 transition hover:text-indigo-600 py-2 smooth-scroll-link">Skills</a>
            <a href="#process" class="block text-base font-medium text-gray-900 transition hover:text-indigo-600 py-2 smooth-scroll-link">Process</a>
            <a href="https://drive.google.com/file/d/1y_O1U4hITaNJYH1SGIr4V9HLGa61QxEq/view?usp=sharing" target="_blank" rel="noopener noreferrer" class="block text-base font-medium text-gray-900 transition hover:text-indigo-600 py-2">Download CV</a>
            
            <div class="flex items-center gap-3 pt-4 border-t border-gray-200">
                <a href="https://www.linkedin.com/in/patrickjameslim/" target="_blank" class="flex items-center justify-center w-10 h-10 rounded-lg border border-gray-200 bg-white text-gray-900 transition hover:bg-indigo-600 hover:text-white">
                    <i class="ri-linkedin-fill"></i>
                </a>
                <button
                    id="mobile-copy-email-btn"
                    type="button"
                    class="flex-1 flex items-center justify-center gap-2 rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium transition hover:bg-indigo-600 hover:text-white"
                >
                    <i class="ri-mail-line"></i>
                    <span>patricklim0907@gmail.com</span>
                </button>
            </div>
        </div>
    </div>
</nav>

<script>
  if (typeof window !== 'undefined') {
    const EMAIL = 'patricklim0907@gmail.com';

    window.addEventListener('DOMContentLoaded', () => {
      // Desktop email copy
      const button = document.getElementById('copy-email-btn');
      const toast = document.getElementById('copy-email-toast');
      const mobileButton = document.getElementById('mobile-copy-email-btn');
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      const menuIcon = document.getElementById('menu-icon');
      const closeIcon = document.getElementById('close-icon');

      let hideTimeout: number;

      const showToast = (toastElement: HTMLElement) => {
        toastElement.classList.remove('opacity-0', 'translate-y-2');
        toastElement.classList.add('opacity-100', 'translate-y-0');

        window.clearTimeout(hideTimeout);
        hideTimeout = window.setTimeout(() => {
          toastElement.classList.add('opacity-0', 'translate-y-2');
          toastElement.classList.remove('opacity-100', 'translate-y-0');
        }, 1800);
      };

      const copyEmail = async (toastElement?: HTMLElement) => {
        try {
          await navigator.clipboard.writeText(EMAIL);
          if (toastElement) {
            showToast(toastElement);
          }
        } catch (error) {
          console.error('Failed to copy email to clipboard', error);
        }
      };

      // Desktop email copy
      if (button && toast) {
        button.addEventListener('click', () => copyEmail(toast));
      }

      // Mobile email copy
      if (mobileButton) {
        mobileButton.addEventListener('click', () => {
          copyEmail();
          // Close mobile menu after copying
          if (mobileMenu) {
            toggleMobileMenu();
          }
        });
      }

      // Mobile menu toggle
      const toggleMobileMenu = () => {
        if (!mobileMenu || !menuIcon || !closeIcon) return;
        
        const isOpen = !mobileMenu.classList.contains('opacity-0');
        
        if (isOpen) {
          // Close menu
          mobileMenu.classList.add('opacity-0', 'pointer-events-none', 'max-h-0');
          mobileMenu.classList.remove('max-h-screen');
          menuIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
        } else {
          // Open menu
          mobileMenu.classList.remove('opacity-0', 'pointer-events-none', 'max-h-0');
          mobileMenu.classList.add('max-h-screen');
          menuIcon.classList.add('hidden');
          closeIcon.classList.remove('hidden');
        }
      };

      if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
      }

      // Smooth scroll for anchor links
      const smoothScrollLinks = document.querySelectorAll('.smooth-scroll-link');
      smoothScrollLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          const href = link.getAttribute('href');
          if (href && href.startsWith('#')) {
            e.preventDefault();
            const targetId = href.substring(1);
            const isHomePage = window.location.pathname === '/' || window.location.pathname === '/index.html' || window.location.pathname.endsWith('/');
            
            if (isHomePage) {
              // We're on the home page, scroll to the section header
              const targetElement = document.getElementById(targetId);
              
              if (targetElement) {
                // Find the header (h1 or h2) within the target section
                const header = targetElement.querySelector('h1, h2');
                const scrollTarget = header || targetElement;
                
                // Get the sticky nav height for offset
                const nav = document.querySelector('nav');
                const navHeight = nav ? nav.offsetHeight : 80;
                
                // Calculate the position
                const elementPosition = scrollTarget.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - navHeight;
                
                // Smooth scroll to the header with offset
                window.scrollTo({
                  top: offsetPosition,
                  behavior: 'smooth'
                });
              }
              
              // Close mobile menu if open
              if (mobileMenu && !mobileMenu.classList.contains('opacity-0')) {
                mobileMenu.classList.add('opacity-0', 'pointer-events-none', 'max-h-0');
                mobileMenu.classList.remove('max-h-screen');
                if (menuIcon && closeIcon) {
                  menuIcon.classList.remove('hidden');
                  closeIcon.classList.add('hidden');
                }
              }
            } else {
              // We're on a different page, navigate to home with hash
              window.location.href = `/${href}`;
            }
          }
        });
      });

      // Close mobile menu when clicking on a link
      if (mobileMenu) {
        const mobileLinks = mobileMenu.querySelectorAll('a');
        mobileLinks.forEach(link => {
          link.addEventListener('click', () => {
            // Only close if it's not a smooth scroll link (those are handled above)
            if (!link.classList.contains('smooth-scroll-link') && mobileMenu && menuIcon && closeIcon) {
              mobileMenu.classList.add('opacity-0', 'pointer-events-none', 'max-h-0');
              mobileMenu.classList.remove('max-h-screen');
              menuIcon.classList.remove('hidden');
              closeIcon.classList.add('hidden');
            }
          });
        });
      }

      // Handle smooth scroll when page loads with a hash
      const isHomePage = window.location.pathname === '/' || window.location.pathname === '/index.html' || window.location.pathname.endsWith('/');
      if (isHomePage && window.location.hash) {
        const hash = window.location.hash.substring(1);
        // Wait for page to fully load, then scroll
        setTimeout(() => {
          const targetElement = document.getElementById(hash);
          if (targetElement) {
            targetElement.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        }, 100);
      }
    });
  }
</script>
